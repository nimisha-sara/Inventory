{% extends "base.html" %}
{% set active_page = "sales" %}
{% block styles %}
<link rel="stylesheet" href="">

<style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400&display=swap');

    .table button {
        border: none;
        background: none;
    }

    button:focus {
        outline: 0;
        box-shadow: none;
    }

    .add button {
        padding: 0.5vh 1vh;
        background: none;
        color: black;
    }

    form {
        font-family: 'Poppins', sans-serif;
    }

    .btn-info:hover {
        background-color: white;
    }

    .btn-info:active:focus {
        background-color: white !important;
        outline-color: white !important;
    }

    .add button {
        border-color: rgb(35, 0, 47);
    }

    .add button:hover {
        background-color: rgb(247, 229, 250);
        color: black;
    }

    .table thead {
        background-color: rgb(35, 0, 47);
        color: rgb(251, 244, 252);
    }

    input[type=text] {
        width: 25vh;
        padding: 0px 5px;
        border: none;
    }

    input[type=number] {
        width: 12vh;
        border: none;
    }

    label {
        font-weight: bold;
    }
</style>
{% endblock %}
{% block title %}Sales{% endblock %}

{% block content %}

<div class="add" style="float: right; margin: 2vh;">
    <!-- Button trigger modal -->
    <button type="button" class="btn btn-info" data-toggle="modal" data-target="#addModal"><span
            class="material-icons-outlined">add</span>Add</button>

    <!-- Modal -->
    <div class="modal fade" id="addModal" tabindex="-1" role="dialog" aria-labelledby=" addModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addModalLabel">Add Sale</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                </div>
                <form method="post" action="{{ url_for( 'add_sale' ) }}">
                    <div class="modal-body">
                        <label for="name">Customer Name: </label>
                        <input style="padding: 5px;" list="names" name="customer-name" id="name" autocomplete="false">
                        <datalist id="names">
                            {% for name in rows['customers'] %}
                            <option value="{{ name[0] }}">
                                {% endfor %}
                        </datalist><br>
                        <label for="address">Address: </label>
                        <input style="padding: 5px;" list="addresses" name="address" id="address" autocomplete="false">
                        <datalist id="addresses">
                            {% for address in rows['addresses'] %}
                            <option value="{{ address[0] }}">
                                {% endfor %}
                        </datalist><br>
                        <label for="city-state">City/State: </label>
                        <input style="padding: 5px;" list="city-states" name="city-state" id="city-state"
                            autocomplete="false">
                        <datalist id="city-states">
                            <option value="City1">
                        </datalist><br>
                        <label for="contact">Mobile: </label>
                        <input list="contacts" name="contact" id="contact" autocomplete="false">
                        <datalist id="contacts">
                            {% for contact in rows['contacts'] %}
                            <option value="{{ contact[0] }}">
                                {% endfor %}
                        </datalist><br><br>
                        <table id="product-table" border="1">
                            <thead>
                                <th style="padding: 5px;">Product Name</th>
                                <th style="padding: 5px;">Quantity</th>
                                <th style="padding: 5px;">Rate</th>
                            </thead>
                            <tbody>
                                {% for i in range(1, 11) %}
                                <tr>
                                    <td><input type="text" name="prod-{{ i }}"></td>
                                    <td><input type="number" name="quant-{{ i }}" min="0" value="0"></td>
                                    <td><input type="number" name="rate-{{ i }}" min="0" value="0"></td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                        <button type="submit" name="add-sale" class="btn btn-success">Save</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<div class="boot">
    <div class="table-responsive-md" style="margin: 2vh">
        <table class="table">
            <thead class="thead">
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">Name</th>
                    <th scope="col">Date of Purchase</th>
                    <th scope="col">Address</th>
                    <th scope="col">Bill Amt</th>
                    <th scope="col">Edit</th>
                    <th scope="col">View Details</th>
                </tr>
            </thead>
            <tbody>
                {% for row in rows['data'] %}
                <tr>
                    <th scope="row">{{ row[0] }}</th>
                    <td>{{ row[1] }}</td>
                    <td>{{ row[9] }}</td>
                    <td>{{ row[2] }}</td>
                    <td>{{ row[7] }}</td>
                    <td>
                        <!-- Button trigger modal -->
                        <button type="button" class="btn btn-info" data-toggle="modal"
                            data-target="#editModal-{{ row[0] }}"><span class="material-icons-outlined"
                                style="color: rgb(27, 0, 59);">edit</span></button>

                        <!-- Modal -->
                        <div class="modal fade" id="editModal-{{ row[0] }}" tabindex="-1" role="dialog"
                            aria-labelledby=" editModalLabel-{{ row[0] }}" aria-hidden="true">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="editModalLabel-{{ row[0] }}">Edit Details</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">×</span>
                                        </button>
                                    </div>

                                    <div class="modal-body">

                                    </div>

                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                                        <button type="button" class="btn btn-success">Save</button>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </td>
                    <td>
                        <!-- Button trigger modal -->
                        <button type="button" class="btn btn-info" data-toggle="modal"
                            data-target="#viewModal-{{ row[0] }}"><span class="material-icons-outlined"
                                style="color: rgb(27, 0, 59);">pageview</span></button>

                        <!-- Modal -->
                        <div class="modal fade" id="viewModal-{{ row[0] }}" tabindex="-1" role="dialog"
                            aria-labelledby=" viewModalLabel-{{ row[0] }}" aria-hidden="true">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="viewModalLabel-{{ row[0] }}"><span
                                                style="font-weight: bold;">Customer: </span>{{ row[1] }}</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">×</span>
                                        </button>
                                    </div>

                                    <div class="modal-body">
                                        <span style="font-weight: bold;">Date of Purchase: </span>{{ row[9] }} <br>
                                        <span style="font-weight: bold;">Address: </span>{{ row[2] }} <br>
                                        <span style="font-weight: bold;">City/State: </span>{{ row[10] }} <br>
                                        <span style="font-weight: bold;">Contact: </span>{{ row[3] }} <br>
                                        {% set _products = row[4].split('$$') %}
                                        {% set _quantity = row[5].split(',') %}
                                        {% set _rates = row[6].split(',') %}
                                        <table class="table table-striped">
                                            <thead>
                                                <th scope="col">#</th>
                                                <th scope="col">Product Name</th>
                                                <th scope="col">Quantity</th>
                                                <th scope="col">Rate</th>
                                            </thead>
                                            <tbody>
                                                {% for j in range(_products|length) %}
                                                <tr>
                                                    <th scope="row">{{ j+1 }}</th>
                                                    <td>{{ _products[j] }}</td>
                                                    <td>{{ _quantity[j] }}</td>
                                                    <td>{{ _rates[j] }}</td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                        <span style="font-weight: bold;">Total Amt: </span>₹ {{ row[7] }}
                                    </div>

                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js">
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/js/bootstrap.min.js">
</script>
<script src="https://cdn.jsdelivr.net/npm/jquery.fancytable/dist/fancyTable.min.js"></script>
<script type="text/javascript">

    $(document).ready(function () {
        $(".table").fancyTable({
            /* Column number for initial sorting*/
            sortColumn: 0,
            /* Setting pagination or enabling */
            pagination: true,
            /* Rows per page kept for display */
            perPage: 1,
            globalSearch: true
        });

    });
</script>
</script>


{% endblock %}